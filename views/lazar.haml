%p= link_to "New prediction", "/predict"
.lazar-predictions

  -# explanations
  = haml :lazar_algorithm, :layout => false
  = haml :confidence, :layout => false
  = haml :similarity, :layout => false
  = haml :significant_fragments, :layout => false
  = haml :training_data, :layout => false

  %a{:name => "prediction"}
  %table
    %thead
      %tr
        %th= @prediction.title
        %th= toggle_link("#lazar_algorithm","Prediction")
        %th= toggle_link("#confidence","Confidence")
        %th Supporting information

      %tr
        -# %td
          %img{:src => @compound.to_image_uri, :alt => @compound.to_smiles}
        %td.image= compound_image(@compound,@prediction.descriptors(@compound))
        %td= activity_markup(@prediction.value(@compound))
        %td= sprintf('%.03g', @prediction.confidence(@compound)) 
        -#%td= @prediction.confidence(@compound)
        %td
          %ul
            %li
              %a{:href => "#prediction", :id => "show_names"} Names and synonyms
              :javascript
                $("a#show_names").click(function () {
                  $("#compound_names").load("#{File.join("/compound",@compound.inchi)}");  
                  $("tr#names").toggle();  
                });
            %li= toggle_link("#fragments","Significant fragments")
            -# This does not work, ask nina/vedrin
            -# %li
              %a{:href => "http://ambit.uni-plovdiv.bg:8080/ambit2/query/structure/?search=#{@compound.smiles}", :rel => "external"} Ambit data
            -# %li
              %a{:href => "http://www.ncbi.nlm.nih.gov/sites/entrez?cmd=PureSearch&db=pccompound&term=#{URI.encode('"'+@compound.inchi+'"[InChI]')}", :rel => "external"}  PubChem data (external)
            -# %li
              %a{:href => "http://chem.sis.nlm.nih.gov/chemidplus/direct.jsp?result=advanced&inchi=#{URI.encode @compound.inchi}", :rel => "external"} ToxNet data
            -#http://chem.sis.nlm.nih.gov/chemidplus/direct.jsp?result=advanced&regno=000143157

      %tr#names{ :style => "display: none;" }
        %td{:colspan => '4'}
          %a{:name => 'names'}
          = hide_link('#names')
          #compound_names
      %tr#fragments{ :style => "display: none;" }
        %td{:colspan => '4'}
          = hide_link('#fragments')
          = haml :feature_table, :locals => {:features => sort(@prediction.descriptors(@compound))}, :layout => false

    %tbody#neighbors
      = haml :neighbors, :locals => {:neighbors => @prediction.neighbors(@compound), :page => @page},  :layout => false

